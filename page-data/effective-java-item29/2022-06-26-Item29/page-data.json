{"componentChunkName":"component---src-templates-post-template-tsx","path":"/effective-java-item29/2022-06-26-Item29/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1>Item 29. 이왕이면 제네릭 타입으로 만들라</h1>\n<h2>일반 Object 기반 스택을 제네릭 스택으로…</h2>\n<h3>일반 Object 기반 스택</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">public class Stack {\r\n   private Object[] elements;\r\n   private int size = 0;\r\n   private static final int DEFAULT_INITIAL_CAPACITY = 16;\r\n\r\n   public Stack() {\r\n      elements = new Object[DEFAULT_INITIAL_CAPACITY];\r\n   }\r\n\r\n   public void push(Object e) {\r\n      ensureCapacity();\r\n      elements[size++] = e;\r\n   }\r\n\r\n   public Object pop() {\r\n      if (size == 0)\r\n         throw new EmptyStackException();\r\n      Object result = elements[--size];\r\n      elements[size] = null;\r\n      return result;\r\n   }\r\n\r\n   private void ensureCapacity() {\r\n      if (elements.length == size)\r\n         elements = Arrays.copyOf(elements, 2 * size);\r\n   }\r\n}</code></pre></div>\n<ul>\n<li>\n<p>Object 기반 스택은 클라이언트가 스택에서 꺼낸 <strong>객체를 형변환</strong>해야 하는데, 이때 <strong>런타임 오류</strong>가 날 위험이 있다.</p>\n</li>\n<li>\n<p>제네릭으로 바꾼다고 해도 Object버전을 하용하던 클라이언트에 아무런 해가 없다.(로타입을 통한 하위 호환성 지원)</p>\n</li>\n</ul>\n<h3>제네릭 스택 변환 - 컴파일 불가</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">public class Stack2&lt;E> {\r\n   private E[] elements;\r\n   private int size = 0;\r\n   private static final int DEFAULT_INITIAL_CAPACITY = 16;\r\n\r\n   public Stack2() {\r\n      elements = new E[DEFAULT_INITIAL_CAPACITY]; // 컴파일 에러 발생!\r\n   }\r\n\r\n   public void push(E e) {\r\n      ensureCapacity();\r\n      elements[size++] = e;\r\n   }\r\n\r\n   public E pop() {\r\n      if (size == 0)\r\n         throw new EmptyStackException();\r\n      E result = elements[--size];\r\n      elements[size] = null;\r\n      return result;\r\n   }\r\n\r\n   ... // isEmpty와 ensureCapacity 메서드는 그대로다.\r\n}</code></pre></div>\n<ul>\n<li>컬렉션 원소의 타입은 보통 <strong>E</strong>를 사용한다.(item 68)</li>\n<li>E와 같은 <strong>실체화 불가 타입</strong>으로는 배열을 만들 수 없어서 <strong>컴파일 에러</strong>가 발생한다.</li>\n</ul>\n<h3>해결1. Object 배열 사용</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@SuppressWarnings(\"unchecked\")\r\npublic MyStack() {\r\n   elements = (E[])new Object[DEFAULT_INITIAL_CAPACITY];\r\n}</code></pre></div>\n<ul>\n<li>Object배열을 생성한 다음 제네릭 배열로 형변환해서 컴파일 오류를 해결한다.</li>\n<li>elements가 private필드이며 외부로 전달되지 않고 오직 push 메소드를 통해서만 원소가 추가되기 때문에 추가되는 원소가 항상 E다. 따라서 이 비검사 형변환은 안전하다.</li>\n<li>@SuppressWarnings 애너테이션으로 경고 메시지를 숨긴다.</li>\n</ul>\n<h3>해결2. elements 필드의 타입을 E[]에서 Object[]로 변경</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">private Object[] elements;\r\n...\r\npublic E pop() {\r\n   if (size == 0)\r\n      throw new EmptyStackException();\r\n   // push에서 E 타입만 허용하므로 이 형변환은 안전하다.\r\n   @SuppressWarnings(\"unchecked\") E result = (E) elements[--size];\r\n   elements[size] = null;\r\n   return result;\r\n}</code></pre></div>\n<ul>\n<li>elements필드의 타입을 E[]에서 Object[]로 변경해서 컴파일 오류를 해결한다.</li>\n<li>마찬가지로 비검사 형변환이 안전한지 스스로 점검하고 @SuppressWarnings 애너테이션으로 경고 메시지를 숨긴다.</li>\n</ul>\n<h3>해결1, 해결2 비교</h3>\n<ul>\n<li>해결1이 더 <strong>가독성</strong>이 좋다\n<ul>\n<li>배열의 타입을 E[]로 선언해서 오직 E타입만 받음을 어필</li>\n<li>코드가 더 짧다.</li>\n<li>배열 생성시만 형변환을 해주면 된다.</li>\n</ul>\n</li>\n<li>해결2는 배열에서 <strong>원소를 읽을 때마다 형변환</strong>을 해줘야 한다.</li>\n<li>해결1은 E가 Object가 아닌 한 **런타임 타입이 컴파일 타입과 달라 힙 오염(heap pollution)**을 일으킬 수 있다.(Item 32)</li>\n</ul>\n<h2>더 알아보기</h2>\n<ul>\n<li>자바가 리스트를 기본 타입으로 제공하지 않으므로 ArrayList 같은 제네릭 타입도 결국은 기본 타입인 배열을 사용해 구현해야 한다.</li>\n<li>Hashmap 같은 제네릭 타입은 성능을 높일 목적으로 배열을 사용하기도 한다.</li>\n<li>타입 매개변수로 int, double과 같은 <strong>기본 타입은 사용할 수 없다</strong>. 박싱된 기본 타입을 사용해 우회할 수 있다.</li>\n<li><code class=\"language-text\">&lt;E extends Delayed></code>와 같이 한정적 타입 매개변수를 통해 Delayed 또는 Delayed의 하위 타입만 받도록 지정할 수 있다.</li>\n</ul>\n<h2>핵심</h2>\n<ul>\n<li>\n<p>클라이언트에서 직접 형변환해야 하는 타입보다 <strong>제네릭 타입이 더 안전하고 쓰기 편하다.</strong></p>\n</li>\n<li>\n<p>기존 타입 중 제네릭이어야 하는게 있다면 제네릭으로 변경하자.</p>\n</li>\n<li>\n<p>기존 클라이언트에는 아무 영향을 주지 않으면서 새로운 사용자를 훨씬 편하게 해주는 길이다.</p>\n</li>\n</ul>","frontmatter":{"title":"이왕이면 제네릭 타입으로 만들라","summary":"effective java 3판 Item29 를 읽고 정리해본다.","date":"2022.06.26.","categories":["이펙티브자바","effective java","글또"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAbABQDASIAAhEBAxEB/8QAGgAAAgIDAAAAAAAAAAAAAAAAAAgBCQMEB//EABUBAQEAAAAAAAAAAAAAAAAAAAUG/9oADAMBAAIQAxAAAAG5rgmFHwKi8IB+XWxI7Yt49iCRAf8A/8QAHhAAAQMEAwAAAAAAAAAAAAAAAwUGBwABAgQQERL/2gAIAQEAAQUCdz0T2dgWZA7Jamz1bRQTFyVKkduqjh1Qxy5kI9A7vhx//8QAIxEAAgEEAQMFAAAAAAAAAAAAAQIDBAUREhMAIVEQIiMxQv/aAAgBAwEBPwGx2yjrGpeeOSQvN8g2KRmMOU19rBj+TsrL3yuD9+lvvU9BwaRQyrC/InIp2yTsRsDlc5I7eT5Oev/EAB8RAAIBBAMBAQAAAAAAAAAAAAECAwQREiEFEDFSYf/aAAgBAgEBPwHk6+pp2mWORECoMbqC2RUNcFhb61ZtC/51V8bHUmXKR0MgCtja2gANEb8HvX//xAAmEAACAQMDBAIDAQAAAAAAAAABAgMEERIFEyEAEBQiMUIjMlFx/9oACAEBAAY/AqCTUKernXUJZ4ovGWM4NBEJW3c3WysDYEAgH9sRz1T0ukaHVmolkGT6k8cNMIL4nFqV55N5mK4pIiAC5bn17aEbyiMVNeZtqwOCU0MnsSCqpdMWLWByxvdh1REn8NSI5hHtxBsFkEq57dyhDSZOOFI+tlsOtOh0yJJTFJV+QJJMFMU8KJi3q4ZWI5BU/A/3pJ/DkkjSYARURqq/BmAscNjiMhNsyKzBBa+HHbkk+7/Jv9j/AHv/AP/EABwQAQACAgMBAAAAAAAAAAAAAAERIQAxEEFR4f/aAAgBAQABPyFKAMS1peJsm8GGQB3IQd+Sqb4MrNeouD4KJNMI7xlGr6SpkdEPP7gLZ6Sfn395ENFOyPzKbOfcIdD7jSs72XUSmjQaCiDn/9oADAMBAAIAAwAAABAnzDD/xAAaEQEBAAIDAAAAAAAAAAAAAAARAQAhEDFB/9oACAEDAQE/EE0YtyIA1R8I83Lnr2uAoh3khLwP/8QAGBEBAQEBAQAAAAAAAAAAAAAAASERADH/2gAIAQIBAT8Qg6sBDsLlZFJR2/VU3hhvPQ0OEgnf/8QAHRABAAIBBQEAAAAAAAAAAAAAAQARIRAxgaGxkf/aAAgBAQABPxBrA1s8g5rkX601n/ACKMIegXM/XpSb6PmCG4KTREUN34vV7i1jcaG3PpikOZ3j1D1ITaI4oIZiiPp5WCBtz6a6lbwNDAYIB4aGBADT/9k="},"images":{"fallback":{"src":"/static/af80a83f970b5d165954e4fccc42c314/47071/icon.jpg","srcSet":"/static/af80a83f970b5d165954e4fccc42c314/d5b61/icon.jpg 224w,\n/static/af80a83f970b5d165954e4fccc42c314/70fc1/icon.jpg 447w,\n/static/af80a83f970b5d165954e4fccc42c314/47071/icon.jpg 894w","sizes":"(min-width: 894px) 894px, 100vw"},"sources":[{"srcSet":"/static/af80a83f970b5d165954e4fccc42c314/26dcb/icon.webp 224w,\n/static/af80a83f970b5d165954e4fccc42c314/95f22/icon.webp 447w,\n/static/af80a83f970b5d165954e4fccc42c314/49563/icon.webp 894w","type":"image/webp","sizes":"(min-width: 894px) 894px, 100vw"}]},"width":894,"height":1200}},"publicURL":"/static/af80a83f970b5d165954e4fccc42c314/icon.jpeg"}}}}]}},"pageContext":{"slug":"/effective-java-item29/2022-06-26-Item29/"}},"staticQueryHashes":[]}